import asyncio
import os
import random
import re
from telethon import events

# –§–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º —á–∞—Ç–æ–≤
CHAT_FILE = "Ignore/Auto_users.txt"  # –§–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ —á–∞—Ç–æ–≤
GIF_PATH = os.path.abspath("–í–∏–¥–µ–æ_–º–∞—Ç–µ—Ä–∏–∞–ª/Gif/My.gif")  # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∏—Ñ–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

WIN_MESSAGES = [  
    "**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Ç–µ–±—è, –†–æ–Ω–∏–Ω! üéâ**\n\n–¢—ã –≤—ã–∏–≥—Ä–∞–ª —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø—Ä–æ—Ä–µ–∫–ª–∞–º–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö! üöÄ –£ —Ç–µ–±—è –µ—Å—Ç—å 24 —á–∞—Å–∞, —á—Ç–æ–±—ã –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è. –ù–µ —É–ø—É—Å—Ç–∏ —à–∞–Ω—Å! üí™\n\n–ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Å–∞–π—Ç: https://muhamedlabs.pro",  

    "**–†–æ–Ω–∏–Ω, —Ç—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å! üèÜ**\n\n–¢–≤–æ—è —É–¥–∞—á–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–∞ –≤—ã—Å–æ—Ç–µ! üòé –¢—ã –ø–æ–ª—É—á–∞–µ—à—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã (–≤–∏–¥–µ–æ –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–π) –Ω–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö! –ñ–¥—ë–º —Ç–≤–æ–π –æ—Ç–≤–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤! ‚è≥\n\n–ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –∑–∞–≥–ª—è–Ω—É—Ç—å –Ω–∞ –Ω–∞—à —Å–∞–π—Ç: https://muhamedlabs.pro",  

    "**–í–Ω–∏–º–∞–Ω–∏–µ, –†–æ–Ω–∏–Ω! –¢—ã –≤—ã–∏–≥—Ä–∞–ª! üí•**\n\n–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–±–µ–¥–æ–π –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ! üéä –£ —Ç–µ–±—è –µ—Å—Ç—å 24 —á–∞—Å–∞, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å —Å–≤–æ–π –ø—Ä–∏–∑ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—É—é —Ä–µ–∫–ª–∞–º—É –Ω–∞ –Ω–∞—à–∏—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö! –ü–∏—à–∏ —Å–∫–æ—Ä–µ–µ! üöÄ\n\n–ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Å–∞–π—Ç: https://muhamedlabs.pro",  

    "**–í–æ—Ç —ç—Ç–æ –≤–µ–∑–µ–Ω–∏–µ, –†–æ–Ω–∏–Ω! üî•**\n\n–¢—ã —Å—Ç–∞–ª –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º –∏ —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ—é –±–µ—Å–ø–ª–∞—Ç–Ω—É—é —Ä–µ–∫–ª–∞–º—É! üèÖ –ù–∞–ø–∏—à–∏ –Ω–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–∑! ‚è≥\n\n–ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –∑–∞–≥–ª—è–Ω—É—Ç—å –Ω–∞ —Å–∞–π—Ç: https://muhamedlabs.pro",  

    "**–¢—ã –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è, –†–æ–Ω–∏–Ω! üèÖ**\n\n–¢–≤–æ–π –≤—ã–∏–≥—Ä—ã—à ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ –Ω–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö! üí™ –ù–µ —É–ø—É—Å—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, —É —Ç–µ–±—è 24 —á–∞—Å–∞, —á—Ç–æ–±—ã –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è! üöÄ\n\n–ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Å–∞–π—Ç: https://muhamedlabs.pro",  
]  

# –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ (–∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ ID —á–∞—Ç–æ–≤)
def load_chat_ids():
    if not os.path.exists(CHAT_FILE):
        print(f"–û—à–∏–±–∫–∞: –§–∞–π–ª '{CHAT_FILE}' –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return []
    
    with open(CHAT_FILE, "r", encoding="utf-8") as file:
        content = file.read()

    chat_ids = re.findall(r"ID —á–∞—Ç–∞: (\d+)", content)  # –†–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ ID
    return list(map(int, chat_ids))  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª

async def send_winner_messages(client):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ –≤ 3 —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∞—Ç–∞."""
    chat_ids = load_chat_ids()
    
    if not chat_ids:
        print("–û—à–∏–±–∫–∞: –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø—É—Å—Ç!")
        return

    if len(chat_ids) < 3:
        print("–û—à–∏–±–∫–∞: –í —Å–ø–∏—Å–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —á–∞—Ç–∞!")
        return

    selected_chats = random.sample(chat_ids, 3)  # –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∞—Ç–∞

    if not os.path.exists(GIF_PATH):
        print(f"–û—à–∏–±–∫–∞: –§–∞–π–ª –≥–∏—Ñ–∫–∏ '{GIF_PATH}' –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return

    for chat_id in selected_chats:
        random_text = random.choice(WIN_MESSAGES)  # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        await client.send_file(chat_id, GIF_PATH, caption=random_text)
        print(f"Sent to chat {chat_id} with a hyphy")

def register_auto_reply(client):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ —Å–ª–æ–≤–æ '—Ç–∏—Ä–∞–∂'."""
    
    @client.on(events.NewMessage(outgoing=True))
    async def check_raffle_trigger(event):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–æ–∑—ã–≥—Ä—ã—à, –µ—Å–ª–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–æ–≤–æ '—Ç–∏—Ä–∞–∂'."""
        if "—Ç–∏—Ä–∞–∂" in event.message.text.lower():
            print("Launch the raffle!")
            await send_winner_messages(client)
